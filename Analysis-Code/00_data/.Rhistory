gompertz_filters <-c(1, 2, 5)
# Run the function
run_and_save_regressions(hatch_growth, r2_levels, logistic_filters)
run_and_save_regressions_gomp(hatch_growth, r2_levels, gompertz_filters)
################################################################################
################## Bivariate Vintage and Growth Speed ##########################
################################################################################
## Load in data
#setwd("/Users/jennagreene/Documents/GitHub/country-tech-growth/country_tech_growth_analysis") # Set to overall folder
file_path = "00_data/technology_growth_Update.csv" # Set File Path
hatch_growth_summ <- read.csv(file_path) # Load in data file
# Create a data frame for variable info, including labels
variable_info <- data.frame(
variable = variables_of_interest,
category = variable_categories,
label = variable_labels)
## ------------- Bivariate linear regressions -------------
## Set variables of interest
country_variables <- c("Capacity_Average",
'dem',
"rdspending_Average",
"Log_GDPavg",
"direction_scitech_Average",
"easier_scitech_Average")
technology_variables <- c("FirstCommercialYr",
"log_Granularity.Numerical",
"log_Material.Use.Numerical",
"log_Average.lifetime",
"Complexity",
"Need.for.Customization",
"Type.of.Adopter",
"Feedstock",
"Broad.replacement")
bracket_information <- list(c("Technology Variables", technology_variables),
c("Country Variables", country_variables))
variables_of_interest <- c(technology_variables, country_variables)
# Create a list of variable categories (Technology vs Country)
variable_categories <- c(rep("Technology", length(technology_variables)),
rep("Country", length(country_variables)))
variable_labels <- c( "First Year of Commercialization",
"Granularity (log)",
"Material Use (log)",
"Lifetime (log)",
'Complexity',
#'Complexity (Design-Intensive)',
#'Complexity (Complex)',
'Need for Customization',
#"Need for Customization (Mass-Customized)",
#"Need for Customization (Customized)",
'Type of Adopter',
#"Type of Adopter (Individuals)",
#"Type of Adopter (Both)",
'Feedstock',
#"Feedstock (Yes)",
'Broad Replacement',
#"Broad Replacement (Yes)",
"Gov. Capacity",
'Type of Gov.',
#"Type of Gov. (Not Democracy)",
"R&D Spending",
"GDP per capita (log)",
"Public Acceptance - Tech. Headed in Right Direction",
"Public Acceptance - Tech. Making Life Easier")
y_labels <- c( "First Year of Commercialization",
"Granularity (log)",
"Material Use (log)",
"Lifetime (log)",
#'Complexity',
'Complexity (Design-Intensive)',
'Complexity (Complex)',
#'Need for Customization',
"Need for Customization (Mass-Customized)",
"Need for Customization (Customized)",
#'Type of Adopter',
"Type of Adopter (Individuals)",
"Type of Adopter (Both)",
#'Feedstock',
"Feedstock (Yes)",
#'Broad Replacement',
"Broad Replacement (Yes)",
"Gov. Capacity",
#'Type of Gov.',
"Type of Gov. (Not Democracy)",
"R&D Spending",
"GDP per capita (log)",
"Public Acceptance - Tech. Headed in Right Direction",
"Public Acceptance - Tech. Making Life Easier")
# Create a data frame for variable info, including labels
variable_info <- data.frame(
variable = variables_of_interest,
category = variable_categories,
label = variable_labels)
setwd('../')
setwd('../')
setwd('02_scripts')
source('regressions_list.R')
modelList <- reg_list(hatch_growth_filter, "Logistic.Fit", variables_of_interest)
setwd('../')
setwd('04_reports')
# Save bivariates
modelsummary(modelList,
stars = TRUE,
statistic = 'p.value',
output = 'bivariate_variables_95.html')
ggplot(data = hatch_growth_filter, mapping = aes(x = ))
ggplot(data = hatch_growth_filter, mapping = aes(x = 'rdspending_Average', y = 'Speed.of.Diffusion'))
ggplot(data = hatch_growth_filter, mapping = aes(x = 'rdspending_Average', y = 'Logistic.Fit'))
lm('Logistic.Fit' ~ 'rdspending_Average', data = hatch_growth_filter)
View(hatch_growth_filter)
View(hatch_growth_filter)
hatch_growth_filter.to_csv('test.csv')
hatch_growth_filter.write_csv('test.csv')
write.csv(hatch_growth_filter, file = "test.csv", row.names = FALSE)
library(dplyr)  #data manipulation and cleaning
## ---- Load in HATCH data ------
setwd('../')
setwd('00_data') # set wd to where the data is saved
data_file_path = 'all_growth_merge_Updated.csv'
hatch_growth <- read.csv(data_file_path) # Load in data file
-------------------------
## Set relevant columns to convert to numerical
hatch_growth$Logistic.Fit <- as.numeric(hatch_growth$Logistic.Fit)
hatch_growth
hatch_growth$Logistic.Fit <- as.numeric(hatch_growth$Logistic.Fit)
hatch_growth$logistic.goodness <- as.numeric(hatch_growth$logistic.goodness)
hatch_growth$FirstCommercialYr <- as.numeric(hatch_growth$FirstCommercialYr)
hatch_growth$Delta.T <- as.numeric(hatch_growth$Delta.T)
source("~/Documents/GitHub/country-tech-growth/hatch_national_growth_analysis/02_scripts/clean_hatch_data.R", echo = TRUE)
library(ggplot2)
library(ggpubr)
library(dplyr)
setwd('../')
setwd('02_scripts')
## ---------------------- Description of HATCH --------------------
# summary of technologies
num_tech <-length(unique(hatch_growth$technology))
print(paste0("Number of Technologies in HATCH (pre-filtering): ", num_tech))
# summary of countries
num_countries <- length(unique(hatch_growth$country))
print(paste0("Number of Countries in HATCH (pre-filtering): ", num_countries))
## ---------------------- Visualize HATCH  Data--------------------
# Create histograms
# Count the number of countries per technology
countries_per_technology <- table(hatch_growth$technology)
# Count the number of technologies per country
technologies_per_country <- table(hatch_growth$country)
# Convert the tables to data frames for better manipulation
countries_per_technology_df <- as.data.frame(countries_per_technology)
technologies_per_country_df <- as.data.frame(technologies_per_country)
# Rename the columns
colnames(countries_per_technology_df) <- c("Technology", "Countries")
colnames(technologies_per_country_df) <- c("Country", "Technologies")
# Technologies with data for only one country
one_country <- nrow(countries_per_technology_df %>% filter(Countries ==1))
print(paste0("There are ", one_country, " technologies with only one country in HATCH"))
# Median number of countries per tech
median_country_count <- median(countries_per_technology_df$Countries)
print(paste0("Median number of countries for each tech ", median_country_count))
# Median number of tech per country
median_tech_per_country <- median(technologies_per_country_df$Technologies)
print(paste0("Median number of technologies per country is ", median_tech_per_country))
# Country with the most technologies
most_tech_per_country <- max(technologies_per_country_df$Technologies)
# Plot histogram for countries per technology
# 0 to 50 then break above 50
breaks_custom <- c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55)
over_50_df <- countries_per_technology_df
over_50_df$Countries [over_50_df$Countries > 50] <- 51
hist <- ggplot(over_50_df, aes(x = Countries)) +
geom_histogram(color = "#000000", fill = "#DAA5ACFF", breaks = breaks_custom) +
labs(title = "Number of Countries per Technology in HATCH",
x = "Number of Countries",
y = "Frequency (# of Tech)") +
scale_x_continuous(limits=c(0, 55), breaks=breaks_custom, labels=c(0,  5, 10, 15, 20, 25, 30, 35, 40, 45, 50, "> 50")) +
theme_minimal() +
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
plot.title = element_text(size = 14, face = "bold"))
setwd('../03_plots/description')
ggsave("countries_per_technology_histogram_Update.png", hist, width = 10, height = 6, units = "in", dpi = 300)
# Plot histogram for technologies per country
breaks_custom_2 <- c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55)
over_50_df_2 <- technologies_per_country_df
over_50_df_2$Technologies [technologies_per_country_df$Technologies > 50] <- 51
hist_2 <- ggplot(over_50_df_2, aes(x = Technologies)) +
geom_histogram(color = "#000000", fill = "#B6E7E0FF", breaks = breaks_custom) +
labs(title = "Number of Technologies per Country in HATCH",
x = "Number of Technologies",
y = "Frequency (# of Countries)") +
scale_x_continuous(limits=c(0, 55), breaks=breaks_custom, labels=c(0,  5, 10, 15, 20, 25, 30, 35, 40, 45, 50, "> 50")) +
theme_minimal() +
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
plot.title = element_text(size = 14, face = "bold"))
#setwd('../03_plots/description')
ggsave("technologies-per-country_Update.png", hist_2, width = 10, height = 6, units = "in", dpi = 300)
## Combine Histograms
descriptive_HATCH_histograms <- ggarrange(hist, hist_2,
labels = c("a", "b"),
ncol =2, nrow = 1)
ggsave("Update_descriptive_histograms.png",
descriptive_HATCH_histograms, width = 11, height = 6, units = "in", dpi = 300)
setwd('../')
setwd('../')
setwd('02_scripts')
# Load in function to create CSVs of summary stats
source('summary_stats.R')
setwd('../')
categorical_variables_tech <- c("Final.Material.Use",
"Technology.Lifetime",
"Granularity",
"Type.of.Adopter",
"Complexity",
"Need.for.Customization",
"Feedstock",
"Broad.replacement",
"Category.Type")
summarize_variable(hatch_growth_filter, categorical_variables_tech,output_dir = "04_reports/description/")
categorical_variables_country <- c("dem", "cap_cat")
aggregate(hatch_growth_filter$Logistic.Fit, list(hatch_growth_filter$dem), summary)
aggregate(hatch_growth_filter$Logistic.Fit, list(hatch_growth_filter$cap_cat), summary)
## Summarize year of first comm.
df_commercialYr <- hatch_growth_filter %>%
select(technology, FirstCommercialYr) %>%
distinct()
# Merge and summarize
# #merge_avg_comm_df <- df_commercialYr %>%
# #  left_join(median_growth_rate, by = "technology")
#
# #merge_avg_comm_df <- merge_avg_comm_df %>%
# #  filter(!is.na(FirstCommercialYr))
#
# ##
# min_year_info <- merge_avg_comm_df %>%
#   filter(FirstCommercialYr == min(FirstCommercialYr)) %>%
#   select(FirstCommercialYr, Logistic.Fit)
#
# max_year_info <- merge_avg_comm_df %>%
#   filter(FirstCommercialYr == max(FirstCommercialYr)) %>%
#   select(FirstCommercialYr, Logistic.Fit)
## ------------ Describe technologies and Countries in the data ------------
setwd('04_reports/description')
### Summary of data after filtering (Supplementary TABLE 2 and 3)
# Supplementary table 2
ctry_per_tech <- hatch_growth_filter %>%
group_by(technology) %>%
summarize(count_by_tech = n())
write.csv(ctry_per_tech, file = "tech_summary_filter.csv", row.names = FALSE)
# Supplementary table 3
tech_per_country <- hatch_growth_filter %>%
group_by(country) %>%
summarize(count_by_country = n())
write.csv(tech_per_country, file = "ctry_summary_filter.csv", row.names = FALSE)
## Summary of tech characteristics after filtering (Supplementary Table 11)
tech_char_hatch_filtered <- hatch_growth_filter %>%
group_by(technology) %>%
summarize(
Material.Use.Numerical = first(Material.Use.Numerical),
Final.Material.Use = first(Final.Material.Use),
FirstCommercialYr = first(FirstCommercialYr),
Need.for.Customization = first(Need.for.Customization),
Complexity = first(Complexity),
Type.of.Adopter = first(Type.of.Adopter),
Granularity.Numerical = first(Granularity.Numerical),
Granularity = first(Granularity),
Average.lifetime = first(Average.lifetime),
Technology.Lifetime = first(Technology.Lifetime),
Strict.replacement = first(Strict.replacement),
Broad.replacement = first(Broad.replacement),
Feedstock = first(Feedstock),
Category.Type = first(Category.Type)
) %>%
ungroup()
write.csv(tech_char_hatch_filtered, file = "tech_characteristics_filtered.csv", row.names = FALSE)
## ------------ Describe filtering by fitting ------------
# Supplementary tables 14 and 15
## Supplementary Table 14
hatch_filtering_initial <- nrow(hatch_growth)
step_1 <- sum(is.na(hatch_growth$Logistic.Fit))
hatch_filtering_aftererr <- hatch_growth[!is.na(hatch_growth$Logistic.Fit), ]
step_2 <- sum(hatch_filtering_aftererr$logistic.goodness < 0.95)
hatch_filtering_95 <- hatch_filtering_aftererr %>% dplyr::filter(logistic.goodness >= 0.95)
nrow(hatch_filtering_95)
step_3 <- sum(hatch_filtering_95$Logistic.Fit > 1)
hatch_filtering_1 <- hatch_filtering_95 %>% dplyr::filter(Logistic.Fit <= 1)
nrow(hatch_filtering_1)
step_4 <- sum(hatch_filtering_1$Logistic.Fit < 0)
hatch_filtering_0 <- hatch_filtering_1 %>% dplyr::filter(Logistic.Fit > 0)
nrow(hatch_filtering_0)
nrow(hatch_growth_filter)
## Supplementary Table 15
hatch_filtering_initial <- nrow(hatch_growth)
hatch_growth$Gompertz.Fit <- as.numeric(hatch_growth$Gompertz.Fit)
step_1_g <- sum(is.na(hatch_growth$Gompertz.Fit))
hatch_filtering_aftererr_g <- hatch_growth[!is.na(hatch_growth$ Gompertz.Fit), ]
nrow(hatch_filtering_aftererr_g)
step_2_g <- sum(hatch_filtering_aftererr_g$gompertz.goodness < 0.95)
hatch_filtering_95_g <- hatch_filtering_aftererr_g %>% dplyr::filter(gompertz.goodness >= 0.95)
nrow(hatch_filtering_95_g)
step_3_g <- sum(hatch_filtering_95_g$Gompertz.Fit > 1)
hatch_filtering_1_g <- hatch_filtering_95_g %>% dplyr::filter(Gompertz.Fit <= 1)
nrow(hatch_filtering_1_g)
step_4 <- sum(hatch_filtering_1_g$Gompertz.Fit < 0)
hatch_filtering_0_g <- hatch_filtering_1_g %>% dplyr::filter(Gompertz.Fit > 0)
nrow(hatch_filtering_0_g)
# Libraries
library(ggplot2)
library(modelsummary)
library(scales)
library(dotwhisker)
setwd('../')
setwd('../')
## Set variables of interest
country_variables <- c("Capacity_Average",
'dem',
"rdspending_Average",
"Log_GDPavg",
"direction_scitech_Average",
"easier_scitech_Average")
technology_variables <- c("FirstCommercialYr",
"log_Granularity.Numerical",
"log_Material.Use.Numerical",
"log_Average.lifetime",
"Complexity",
"Need.for.Customization",
"Type.of.Adopter",
"Feedstock",
"Broad.replacement")
bracket_information <- list(c("Technology Variables", technology_variables),
c("Country Variables", country_variables))
variables_of_interest <- c(technology_variables, country_variables)
# Create a list of variable categories (Technology vs Country)
variable_categories <- c(rep("Technology", length(technology_variables)),
rep("Country", length(country_variables)))
variable_labels <- c( "First Year of Commercialization",
"Granularity (log)",
"Material Use (log)",
"Lifetime (log)",
'Complexity',
#'Complexity (Design-Intensive)',
#'Complexity (Complex)',
'Need for Customization',
#"Need for Customization (Mass-Customized)",
#"Need for Customization (Customized)",
'Type of Adopter',
#"Type of Adopter (Individuals)",
#"Type of Adopter (Both)",
'Feedstock',
#"Feedstock (Yes)",
'Broad Replacement',
#"Broad Replacement (Yes)",
"Gov. Capacity",
'Type of Gov.',
#"Type of Gov. (Not Democracy)",
"R&D Spending",
"GDP per capita (log)",
"Public Acceptance - Tech. Headed in Right Direction",
"Public Acceptance - Tech. Making Life Easier")
y_labels <- c( "First Year of Commercialization",
"Granularity (log)",
"Material Use (log)",
"Lifetime (log)",
#'Complexity',
'Complexity (Design-Intensive)',
'Complexity (Complex)',
#'Need for Customization',
"Need for Customization (Mass-Customized)",
"Need for Customization (Customized)",
#'Type of Adopter',
"Type of Adopter (Individuals)",
"Type of Adopter (Both)",
#'Feedstock',
"Feedstock (Yes)",
#'Broad Replacement',
"Broad Replacement (Yes)",
"Gov. Capacity",
#'Type of Gov.',
"Type of Gov. (Not Democracy)",
"R&D Spending",
"GDP per capita (log)",
"Public Acceptance - Tech. Headed in Right Direction",
"Public Acceptance - Tech. Making Life Easier")
# Create a data frame for variable info, including labels
variable_info <- data.frame(
variable = variables_of_interest,
category = variable_categories,
label = variable_labels)
setwd('02_scripts')
source('regressions_list.R')
modelList <- reg_list(hatch_growth_filter, "Logistic.Fit", variables_of_interest)
setwd('../')
setwd('04_reports')
# Save bivariates
modelsummary(modelList,
stars = TRUE,
statistic = 'p.value',
output = 'bivariate_variables_95.html')
# Jenna Greene
#install.packages('dplyr')
library(dplyr)  #data manipulation and cleaning
## ---- Load in HATCH data ------
setwd('../')
setwd('00_data') # set wd to where the data is saved
data_file_path = 'all_growth_merge_Updated.csv'
hatch_growth <- read.csv(data_file_path) # Load in data file
## ---------------------------- Clean Dataset ----------------------------------
## Set relevant columns to convert to numerical
hatch_growth$Logistic.Fit <- as.numeric(hatch_growth$Logistic.Fit)
hatch_growth$logistic.goodness <- as.numeric(hatch_growth$logistic.goodness)
hatch_growth$FirstCommercialYr <- as.numeric(hatch_growth$FirstCommercialYr)
hatch_growth$Delta.T <- as.numeric(hatch_growth$Delta.T)
hatch_growth$Logistic.Saturation <- as.numeric(hatch_growth$Logistic.Saturation)
## Log relevant variables
# In hatch data, some variables are categorical
exclude_values <- c('Cheap', 'Low', 'Small', 'Medium', 'Large', 'Expensive')
hatch_growth$log_Granularity.Numerical <- ifelse(is.na(as.numeric(hatch_growth$Granularity.Numerical)),
NA,
log(as.numeric(hatch_growth$Granularity.Numerical)))
hatch_growth$log_Material.Use.Numerical <- ifelse(is.na(as.numeric(hatch_growth$Material.Use.Numerical)),
NA,
log(as.numeric(hatch_growth$Material.Use.Numerical)))
hatch_growth$log_Material.Use.Numerical <- ifelse(is.infinite(as.numeric(hatch_growth$log_Material.Use.Numerical)),
NA,
hatch_growth$log_Material.Use.Numerical)
hatch_growth$log_Average.lifetime <- ifelse(is.na(as.numeric(hatch_growth$Average.lifetime)),
NA,
log(as.numeric(hatch_growth$Average.lifetime)))
## Rescale categorical variables
# Material Use
hatch_growth$Final.Material.Use <- factor(hatch_growth$Final.Material.Use,
order = TRUE,
levels = c("Low Material Use",
"Medium Material Use",
"High Material Use"))
# Tech Lifetime
hatch_growth$Technology.Lifetime <- factor(hatch_growth$Technology.Lifetime,
order = TRUE,
levels = c("Months",
"Years",
"Decades",
"Centuries"))
# Granularity
hatch_growth$Granularity <- factor(hatch_growth$Granularity,
order = TRUE,
levels = c("Low",
"Medium",
"High"))
# Type of Adopter
hatch_growth$Type.of.Adopter <- factor(hatch_growth$Type.of.Adopter,
order = FALSE,
levels = c("Firms [1]",
"Individuals [2]",
"Both [3]"))
# Complexity
hatch_growth$Complexity <- factor(hatch_growth$Complexity,
order = TRUE,
levels = c("Simple [1]",
"Design-Intensive [2]",
"Complex [3]"))
# Need for Customization
hatch_growth$Need.for.Customization <- factor(hatch_growth$Need.for.Customization,
order = TRUE,
levels = c("Standardized [1]",
"Mass-customized [2]",
"Customized [3]"))
# Democracy
hatch_growth$dem <- factor(hatch_growth$dem,
order = FALSE,
levels = c('Democracy', 'Not Democracy'))
# Feedstock
hatch_growth$Feedstock <- factor(hatch_growth$Feedstock,
order = FALSE,
levels = c('No', 'Yes'))
# Replacement
hatch_growth$Broad.replacement <- factor(hatch_growth$Broad.replacement,
order = FALSE,
levels = c('No', 'Yes'))
# Patent Category
hatch_growth$Patent.Category.Name <- as.factor(hatch_growth$Patent.Category.Name)
# Broad Categories
hatch_growth$Category.Type <- as.factor(hatch_growth$Category.Type)
# Strict Replacement
hatch_growth$Strict.replacement <- as.factor(hatch_growth$Strict.replacement)
## Ordinal
levels_regime <- c(0, 1, 2, 3, 4, 5)
hatch_growth$regime_Mode <- ordered(hatch_growth$regime_Mode,
levels = levels_regime)
## Create high / low state capacity data
hatch_growth <- hatch_growth %>%
mutate(cap_cat = case_when(Capacity_Average > 0 ~ 'High',
Capacity_Average <= 0 ~ 'Low'))
cap_cat_levels <- c('Low', 'High')
hatch_growth$cap_cat <- factor(hatch_growth$cap_cat, levels = cap_cat_levels)
## Create levels of econ data
hatch_growth <- hatch_growth %>%
mutate(econlevel = case_when(IncomeGroup_Mode == "L" ~ 'Low',
IncomeGroup_Mode == "LM" ~ 'Low',
IncomeGroup_Mode == "UM" ~ "High",
IncomeGroup_Mode == "H" ~ "High"))
hatch_growth$econlevel <- factor(hatch_growth$econlevel,
order = TRUE,
levels = c('Low', 'High'))
###  ------------------------Filter HATCH Dataset -------------------------
# Filter dataset
R2_filter <- 0.95
# Filter to only include logistic fits
hatch_growth_filter <- hatch_growth[which(hatch_growth$Logistic.Fit >= 0 &
hatch_growth$Logistic.Fit != 'err' &
hatch_growth$Logistic.Fit <= 1 &
hatch_growth$logistic.goodness > R2_filter), ]
### ------------------------ Save R Datasets -----------------------------------
save(hatch_growth, hatch_growth_filter, file = 'hatch_growth_data.RData')
